#!/usr/bin/env -S nu --stdin

def main [inpat: string, outpat: string] {
    $in
    | lines
    | par-each -k {|s|
        let v = $s
            | str replace --all --regex '\s+' ' '
            | parse $inpat
            | into record

        if ($v | is-empty) {
            $s
        } else {
            $v | format pattern $outpat
        }
    }
    | str join (char nl)
}
